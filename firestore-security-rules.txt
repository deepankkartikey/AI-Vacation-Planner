// Copy these Firestore Security Rules to your Firebase Console
// Go to Firebase Console > Firestore Database > Rules and replace the existing rules with these:

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow PUBLIC READ access to ALL trips (for sharing functionality)
    // Allow authenticated users to write their own trip data
    match /UserTrips/{document} {
      // Anyone can read any trip (for sharing links)
      allow read: if true;
      
      // Only authenticated owners can write/update/delete
      allow write: if request.auth != null && request.auth.token.email == request.resource.data.userEmail;
      allow create: if request.auth != null && request.auth.token.email == request.resource.data.userEmail;
      allow update: if request.auth != null && request.auth.token.email == resource.data.userEmail;
      allow delete: if request.auth != null && request.auth.token.email == resource.data.userEmail;
    }
    
    // Also allow access by userId for future compatibility
    match /UserTrips/{document} {
      allow write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow update: if request.auth != null && request.auth.uid == resource.data.userId;
    }
    
    // Allow authenticated users to read and write their own user profile data
    match /Users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/* 
INSTRUCTIONS TO UPDATE FIRESTORE SECURITY RULES:
1. Go to https://console.firebase.google.com/
2. Select your project: ai-vacation-planner-f40c0
3. Click on "Firestore Database" in the left sidebar
4. Click on the "Rules" tab
5. Replace the existing rules with the rules above
6. Click "Publish" to apply the new rules

IMPORTANT CHANGES:
- Added PUBLIC READ access to UserTrips collection (allow read: if true)
- This enables the share functionality to work for unauthenticated users
- Write/update/delete operations still require authentication and ownership
- Users can only modify their own trips
- Anyone with a link can view shared trips

These rules will:
- Allow ANYONE to read trip data (needed for sharing links)
- Allow authenticated users to create, update, and delete their own trips
- Ensure users can only modify their own data (based on userEmail/userId)
- Allow unauthenticated users to view shared trips via links
*/